<html>

</html>

<head>
    <link rel="icon" type="image/png" href="/favicon.png">

    <script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
    <script async
        src="https://cdn.jsdelivr.net/gh/iammacheta/prebid-code@6e53193d5e03248ce36534294166c50ce159d816/prebid.js"></script>
    <!-- <script async src="https://storage.cloud.google.com/cdn.mobalytics.gg/assets/common/prebid/prebid.js"></script> -->

    <script>
        var div_display_m_sizes = [
            [300, 250],
            [336, 280],
            [300, 50],
            [320, 100],
            [300, 100],
            [250, 250],
            [200, 200],
        ];
        var div_display_l_sizes = [
            [300, 250],
            [336, 280],
            [320, 50],
            [320, 100],
            [300, 50],
            [300, 100],
            [250, 360],
            [250, 250],
            [200, 200],
        ];
        var div_display_footer_d_sizes = [
            [728, 90],
        ];
        var div_display_footer_m_sizes = [
            [320, 50],
            [320, 100],
            [300, 50],
            [300, 100],
        ];

        var PREBID_TIMEOUT = 2000;
        var FAILSAFE_TIMEOUT = 3000;

        var adUnits = [
            {
                code: '/21974715207/web-destiny-2-display-m',
                mediaTypes: {
                    banner: {
                        sizes: div_display_m_sizes
                    }
                },
                bids: [
                    {
                        bidder: 'pubmatic',
                        params: {
                            publisherId: '165261',
                            adSlot: '6141440'
                        }
                    },
                    {
                        bidder: 'appnexus',
                        params: {
                            placementId: 34122281,
                            allowSmallerSizes: true,
                            position: 'above'
                        }
                    },
                    {
                        bidder: "adagio",
                        params: {
                            organizationId: "1458",
                            site: "mobalytics-gg",
                        }
                    },
                    {
                        bidder: 'oms',
                        params: {
                            publisherId: '21048',
                        }
                    },
                    {
                        bidder: 'sovrn',
                        params: {
                            tagid: '1256209'
                        }
                    },
                    {
                        bidder: 'openx',
                        params: {
                            unit: '561445368',
                            delDomain: 'mobalytics-d.openx.net',
                        }
                    },
                    {
                        bidder: "onetag",
                        params: {
                            pubId: "80ac484cd63fd7e",
                            ext: { placement_name: "web-destiny-2-display-m" },
                        }
                    },
                    {
                        bidder: 'smartadserver',
                        params: {
                            siteId: 682899,
                            pageId: 2035035,
                            formatId: 135866,
                        },
                    },
                    {
                        bidder: 'gumgum',
                        params: {
                            zone: 'bdppvphq',
                            slot: '1155240'
                        }
                    },
                    {
                        bidder: 'inmobi',
                        params: {
                            plc: '10000167297',
                        }
                    },
                    {
                        bidder: "ogury",
                        params: {
                            adUnitId: 'wd-hb-stdb-mobaly-mobal-6xnjqbcd90zb',
                            assetKey: 'OGY-1D9A57637CDD'
                        }
                    }
                ],
                ortb2Imp: {
                    ext: {
                        data: {
                            divId: "web-destiny-2-display-m",
                            placement: "sidebar-1",
                        }
                    }
                }
            },
            {
                code: '/21974715207/web-destiny-2-display-l',
                mediaTypes: {
                    banner: {
                        sizes: div_display_l_sizes
                    }
                },
                bids: [
                    {
                        bidder: 'pubmatic',
                        params: {
                            publisherId: '165261',
                            adSlot: '6141441'
                        }
                    },
                    {
                        bidder: 'appnexus',
                        params: {
                            placementId: 34122285,
                            allowSmallerSizes: true,
                        }
                    },
                    {
                        bidder: "adagio",
                        params: {
                            organizationId: "1458",
                            site: "mobalytics-gg",
                        }
                    },
                    {
                        bidder: 'oms',
                        params: {
                            publisherId: '21048',
                        }
                    },
                    {
                        bidder: 'sovrn',
                        params: {
                            tagid: '1256210'
                        }
                    },
                    {
                        bidder: 'openx',
                        params: {
                            unit: '561445369',
                            delDomain: 'mobalytics-d.openx.net',
                        }
                    },
                    {
                        bidder: "onetag",
                        params: {
                            pubId: "80ac484cd63fd7e",
                            ext: { placement_name: "web-destiny-2-display-l" },
                        }
                    },
                    {
                        bidder: 'smartadserver',
                        params: {
                            siteId: 682899,
                            pageId: 2035036,
                            formatId: 135867,
                        },
                    },
                    {
                        bidder: 'gumgum',
                        params: {
                            zone: 'bdppvphq',
                            slot: '1273326'
                        }
                    },
                    {
                        bidder: 'inmobi',
                        params: {
                            plc: '10000167298',
                        }
                    }
                ],
                ortb2Imp: {
                    ext: {
                        data: {
                            divId: "web-destiny-2-display-l",
                            placement: "sidebar-2",
                        }
                    }
                }
            },
            {
                code: '/21974715207/web-destiny-2-display-3',
                mediaTypes: {
                    banner: {
                        sizes: div_display_m_sizes
                    }
                },
                bids: [
                    {
                        bidder: "adagio",
                        params: {
                            organizationId: "1458",
                            site: "mobalytics-gg",
                        }
                    },
                    {
                        bidder: 'oms',
                        params: {
                            publisherId: '21048',
                        }
                    },
                    {
                        bidder: 'gumgum',
                        params: {
                            zone: 'bdppvphq',
                            slot: '1273323'
                        }
                    },
                    {
                        bidder: 'inmobi',
                        params: {
                            plc: '10000167299',
                        }
                    }
                ],
                ortb2Imp: {
                    ext: {
                        data: {
                            divId: "web-destiny-2-display-3",
                            placement: "sidebar-3",
                        }
                    }
                }
            },
            {
                code: '/21974715207/web-destiny-2-display-footer-d',
                mediaTypes: {
                    banner: {
                        sizes: div_display_footer_d_sizes
                    }
                },
                bids: [
                    {
                        bidder: 'pubmatic',
                        params: {
                            publisherId: '165261',
                            adSlot: '6141442'
                        }
                    },
                    {
                        bidder: 'appnexus',
                        params: {
                            placementId: 34122289,
                            position: 'above'
                        }
                    },
                    {
                        bidder: "adagio",
                        params: {
                            organizationId: "1458",
                            site: "mobalytics-gg",
                        }
                    },
                    {
                        bidder: 'oms',
                        params: {
                            publisherId: '21048',
                        }
                    },
                    {
                        bidder: 'sovrn',
                        params: {
                            tagid: '1256211'
                        }
                    },
                    {
                        bidder: 'openx',
                        params: {
                            unit: '561445370',
                            delDomain: 'mobalytics-d.openx.net',
                        }
                    },
                    {
                        bidder: "onetag",
                        params: {
                            pubId: "80ac484cd63fd7e",
                            ext: { placement_name: "web-destiny-2-display-footer-d" },
                        }
                    },
                    {
                        bidder: 'smartadserver',
                        params: {
                            siteId: 682899,
                            pageId: 2035037,
                            formatId: 135868,
                        },
                    },
                    {
                        bidder: 'gumgum',
                        params: {
                            zone: 'bdppvphq',
                            slot: '1273327'
                        }
                    },
                    {
                        bidder: 'inmobi',
                        params: {
                            plc: '10000167300',
                        }
                    },
                    {
                        bidder: "ogury",
                        params: {
                            adUnitId: 'wd-hb-stdb-mobaly-mobal-by5lcxwkbpyj',
                            assetKey: 'OGY-1D9A57637CDD'
                        }
                    }

                ],
                ortb2Imp: {
                    ext: {
                        data: {
                            divId: "web-destiny-2-display-footer-d",
                            placement: "footer-w",
                        }
                    }
                }
            },
            {
                code: '/21974715207/web-destiny-2-display-footer-m',
                mediaTypes: {
                    banner: {
                        sizes: div_display_footer_m_sizes
                    }
                },
                bids: [
                    {
                        bidder: 'pubmatic',
                        params: {
                            publisherId: '165261',
                            adSlot: '6141443'
                        }
                    },
                    {
                        bidder: 'appnexus',
                        params: {
                            placementId: 34122291,
                            allowSmallerSizes: true,
                            position: 'above'
                        }
                    },
                    {
                        bidder: "adagio",
                        params: {
                            organizationId: "1458",
                            site: "mobalytics-gg",
                        }
                    },
                    {
                        bidder: 'oms',
                        params: {
                            publisherId: '21048',
                        }
                    },
                    {
                        bidder: 'sovrn',
                        params: {
                            tagid: '1256212'
                        }
                    },
                    {
                        bidder: 'openx',
                        params: {
                            unit: '561445371',
                            delDomain: 'mobalytics-d.openx.net',
                        }
                    },
                    {
                        bidder: "onetag",
                        params: {
                            pubId: "80ac484cd63fd7e",
                            ext: { placement_name: "web-destiny-2-display-footer-m" },
                        }
                    },
                    {
                        bidder: 'smartadserver',
                        params: {
                            siteId: 682899,
                            pageId: 2035038,
                            formatId: 135869,
                        },
                    },
                    {
                        bidder: 'gumgum',
                        params: {
                            zone: 'bdppvphq',
                            slot: '1273329'
                        }
                    },
                    {
                        bidder: 'inmobi',
                        params: {
                            plc: '10000167301',
                        }
                    },
                    {
                        bidder: "ogury",
                        params: {
                            adUnitId: 'wm-hb-foot-mobaly-mobal-p0t0g8k3cci1',
                            assetKey: 'OGY-1D9A57637CDD'
                        }
                    }
                ],
                ortb2Imp: {
                    ext: {
                        data: {
                            divId: "web-destiny-2-display-footer-m",
                            placement: "footer-s",
                        }
                    }
                }
            },
        ];

        const customConfigObject = {
            "buckets": [
                {
                    "max": 3,
                    "increment": 0.01
                },
                {
                    "max": 5,
                    "increment": 0.05
                },
                {
                    "max": 9,
                    "increment": 0.1
                },
                {
                    "max": 40,
                    "increment": 0.5
                },
                {
                    "max": 100,
                    "increment": 10.00
                }
            ]
        };

        // ======== DO NOT EDIT BELOW THIS LINE =========== //

        var googletag = googletag || {};
        googletag.cmd = googletag.cmd || [];

        var pbjs = pbjs || {};
        pbjs.que = pbjs.que || [];

        async function firstBlock() {
            console.log("Выполняем первый блок...");

            googletag.cmd.push(function () {
                googletag.pubads().disableInitialLoad();
            });

            console.log("Первый блок завершён.");
        }

        async function secondBlock() {
            console.log("Ждём перед вторым блоком...");
            await new Promise(resolve => setTimeout(resolve, 2000));

            console.log("Выполняем второй блок...");


            var pbjs = pbjs || {};
            pbjs.que = pbjs.que || [];

            pbjs.que.push(function () {
                pbjs.onEvent('auctionDebug', function (eventData) {
                    if (
                        eventData &&
                        eventData.type === 'ERROR' &&
                        eventData.arguments &&
                        eventData.arguments[0] === 'TCF2 CMP not found. Canceling auction as per consentManagement config.'
                    ) {
                        console.log("CMP NOT FOUND ERROR OCCURED. SENDING EVENT TO MIXPANEL ||||||||||||||||||||||||||||||||")
                    }
                });
            });

            pbjs.que.push(function () {
                pbjs.bidderSettings = {
                    standard: {
                        storageAllowed: true
                    }
                }

                pbjs.setConfig({
                    useBidCache: true,
                    minBidCacheTTL: 10,
                    eventHistoryTTL: 10,
                    enableSendAllBids: false,
                    enableTIDs: true,
                    priceGranularity: customConfigObject,
                    consentManagement: {
                        gdpr: {
                            cmpApi: "iab",
                            timeout: 500,
                            actionTimeout: 10000,
                            defaultGdprScope: true,
                            allowAuctionWithoutConsent: true,
                            rules: [
                                {
                                    purpose: "storage",
                                    enforcePurpose: true,
                                    enforceVendor: true,
                                    vendorExceptions: ["uid2"]
                                },
                                {
                                    purpose: "basicAds",
                                    enforcePurpose: true,
                                    enforceVendor: true,
                                    vendorExceptions: ["uid2"]
                                },
                                {
                                    purpose: "personalizedAds",
                                    enforcePurpose: true,
                                    enforceVendor: true,
                                    vendorExceptions: ["uid2"]
                                },
                                {
                                    purpose: "measurement",
                                    enforcePurpose: true,
                                    enforceVendor: true
                                },
                                {
                                    purpose: "transmitPreciseGeo",
                                    enforcePurpose: true
                                }
                            ]
                        },
                        usp: {
                            cmpApi: "iab",
                            timeout: 500
                        }
                    },
                    gptPreAuction: {
                        enabled: true,
                    },
                    currency: {
                        adServerCurrency: 'USD',
                        granularityMultiplier: 1,
                        defaultRates: {
                            'EUR': 1.10,
                            'GBP': 1.30
                        },
                        conversionRateFile: 'https://cdn.jsdelivr.net/gh/prebid/currency-file@1/latest.json',
                    },
                    deviceAccess: true,
                    userSync: {
                        filterSettings: {
                            iframe: {
                                bidders: '*',
                                filter: 'include'
                            }
                        },
                        userIds: [
                            {
                                name: "sharedId",
                                storage: {
                                    type: "cookie",
                                    name: "_sharedid",
                                    expires: 365
                                }
                            },
                            {
                                name: "uid2",
                                params: {
                                    emailHash: "NU/pdbyygiVmxYIr/X9+7jwqS4tAQslQeMTRK8A7AL4=",
                                    serverPublicKey: "UID2-X-P-MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEoECNf4b0xQ5+LKMVe9iLELdbxlwCoZ3T3sZ3ZpvSWznJ58bzMz8XQhOiaMXBrqEig6rK/ut7irZI7esUWvVZIA==",
                                    subscriptionId: "TG5mQTPCsw",
                                }
                            },
                            {
                                name: "criteo",
                            },
                            {
                                name: 'id5Id',
                                params: {
                                    partner: 1779,
                                    externalModuleUrl: 'https://cdn.id5-sync.com/api/1.0/id5PrebidModule.js',
                                    pd: 'NU/pdbyygiVmxYIr/X9+7jwqS4tAQslQeMTRK8A7AL4=',
                                },
                                storage: {
                                    type: 'html5',
                                    name: 'id5id',
                                    expires: 90,
                                    refreshInSeconds: 7200
                                }
                            }],
                        auctionDelay: 250
                    }
                });
                console.log("pbjs.setConfig выполнен.");
            });

            console.log("Второй блок завершён.");
        }

        async function thirdBlock() {
            console.log("Ждём перед третьим блоком...");
            await new Promise(resolve => setTimeout(resolve, 2000));

            console.log("Выполняем третий блок...");
            pbjs.registerSignalSources();
            pbjs.addAdUnits(adUnits);
            pbjs.requestBids({
                bidsBackHandler: initAdserver,
                timeout: PREBID_TIMEOUT
            });

            function initAdserver() {
                if (pbjs.initAdserverSet) return;
                pbjs.initAdserverSet = true;
                googletag.cmd.push(function () {
                    pbjs.que.push(function () {
                        pbjs.setTargetingForGPTAsync();
                        googletag.pubads().setTargeting("refresh_N", "1");
                        googletag.pubads().refresh();
                    });
                });
            }
            setTimeout(function () {
                initAdserver();
            }, FAILSAFE_TIMEOUT);

            googletag.cmd.push(function () {
                googletag.defineSlot('/21974715207/web-destiny-2-display-m', div_display_m_sizes, 'div_display_m').addService(googletag.pubads());
                googletag.pubads().enableSingleRequest();
                googletag.enableServices();
            });
            googletag.cmd.push(function () {
                googletag.defineSlot('/21974715207/web-destiny-2-display-l', div_display_l_sizes, 'div_display_l').addService(googletag.pubads());
                googletag.pubads().enableSingleRequest();
                googletag.enableServices();
            });

            googletag.cmd.push(function () {
                googletag.pubads().collapseEmptyDivs();
                googletag.display('div_display_m');
            });

            googletag.cmd.push(function () {
                googletag.pubads().collapseEmptyDivs();
                googletag.display('div_display_l');
            });

            console.log("Третий блок завершён.");
        }

        async function runSequence() {
            await firstBlock();
            await secondBlock();
            await thirdBlock();
        }

        document.addEventListener("DOMContentLoaded", runSequence);
    </script>
</head>

<body>
    <h2>Basic Prebid.js Example</h2>

    <h5>Div display_m</h5>
    <div id="div_display_m" style="width: 336px; height: 280px;"></div>

    <h5>Div display_l</h5>
    <div id="div_display_l" style="width: 336px; height: 280px;"></div>
</body>

</html>